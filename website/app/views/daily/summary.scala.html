@(dateStr: String, 
   pingredients: List[IngredientConsumed], 
   myForm:Form[(Long, BigDecimal, Option[java.util.Date], Option[java.util.Date])]
 )
 
@import java.util.Date
@import views.html._
@import helper._
@import models.website.IngredientConsumedHelper

@* ==== Defining a global data with Glucides, Proteines and Lipides ====*@
@defining(
  pingredients.foldLeft((0.0, 0.0, 0.0)) { 
    case((glucAc, lipAc, protAc), elem) => 
       val gluc = (elem.ingredient.glucides.getOrElse(0.0) * elem.quantity / 100.0)
       val lip = (elem.ingredient.lipides.getOrElse(0.0) * elem.quantity / 100.0)
       val prot = (elem.ingredient.proteines.getOrElse(0.0) * elem.quantity / 100.0)
       (glucAc+gluc, lipAc+lip, protAc+prot)
  }
){ glucides_proteines_lipides =>


@main("Affichage des ingrédients consommés", s"Journée du ${dateStr}" ) {

<section id="addAnIngredient">
<div class="row">
    @helper.form(action = controllers.website.routes.Application.addIngredient, 'id -> "addIngredient") {
        <div class="span3 inputIngredient">
        @inputText(myForm("id"), '_label -> "Id")
        </div><div class="span3 offset1">
        @inputText(myForm("quantity"), '_label -> "Quantité")
        </div><div class="span1 offset1">
        <input type="submit" class="btn primary" value="Ajouter"> 
        </div>
    }
</div>
</section> 

<section id="showIngredientsConsomed">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Id</th>
          <th>Quantité</th>
          <th width="300">Nom</th>
          <th>Famille</th>
          @*<th>Glucides/100gr</th>
          <th>Lipides/100gr</th>
          <th>Protéines/100gr</th>*@
          <th>Glucides</th>
          <th>Lipides</th>
          <th>Protéines</th>
        </tr>
      </thead>
      <tbody>
       @for(ing <- pingredients) {
        <tr>
        <td>@ing.ingredient.id.get</td>
        <td>
            @{
               val res = ing.quantity;
               f"$res%1.2f"
            }
        </td>
        <td widtd="300">@ing.ingredient.name</td>
        <td>@{(ing.ingredient.family map {_.name }).getOrElse("");}</td>
        @*<td>@ing.ingredient("Glucides").getOrElse("Pas de données")</td>
        <td>@ing.ingredient("Lipides").getOrElse("Pas de données")</td>
        <td>@ing.ingredient("Protéines").getOrElse("Pas de données")</td>*@
        <td>@{
               val res = ing.ingredient.glucides.getOrElse(0.0) * ing.quantity / 100.0;
               f"$res%1.2f"
             }
        </td>
        <td>@{
               val res = ing.ingredient.lipides.getOrElse(0.0) * ing.quantity / 100.0;
               f"$res%1.2f"
             }
        </td>
        <td>@{
               val res = ing.ingredient.proteines.getOrElse(0.0) * ing.quantity / 100.0;
               f"$res%1.2f"
             }
        </td>
       </tr>
      }
      </tbody>
      <tfoot>
       <tr>
        <td></td>
        <td></td>
        <td></td>
        <td>Total : </td>
        @*<td>Glucides/100gr</td>
        <td>Lipides/100gr</td>
        <td>Protéines/100gr</td>*@
        @{
          Html(f"""
          <td>${glucides_proteines_lipides._1}%1.2f</td>
          <td>${glucides_proteines_lipides._2}%1.2f</td>
          <td>${glucides_proteines_lipides._3}%1.2f</td>
          """)
        }
       </tr>
      </tfoot>
     </table>
</section>

<section id="showGraph">
    <style type="text/css">
    	div.graph
    	{
    		width: 400px;
    		height: 300px;
    		border: 1px dashed gainsboro;
    	}
    </style>
    <center>
        <div id="default" class="graph"></div>
    </center>
    
    <script type="text/javascript" charset="utf-8">   
        var data = [];
    	data[0] = { label: "Glucides", data: @{glucides_proteines_lipides._1} };
    	data[1] = { label: "Lipides", data: @{glucides_proteines_lipides._2} };
    	data[2] = { label: "Protéines", data: @{glucides_proteines_lipides._3} };
    
    
    	// DEFAULT
        $.plot($("#default"), data, 
    	{
    		series: {
    			pie: { 
    				show: true
    			}
    		}
    	});
    	
    </script>
</section>

<script type="text/javascript" charset="utf-8">


// -- renumber fields
   
    var addAutoCompletion = function() {
        $('div.inputIngredient >* input').each(function(index, element) {
            $(this).autocomplete({
                source:  "http://localhost:9000/ingredients/startwith.json",
                minLength: 3
            });
        })
    }
    $(function() {
           addAutoCompletion();
    })
</script>
}@*end main*@
}@*end defining*@
